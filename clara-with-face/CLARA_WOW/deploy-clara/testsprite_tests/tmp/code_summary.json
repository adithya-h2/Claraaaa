{
  "tech_stack": [
    "TypeScript",
    "React 19",
    "Express.js",
    "Socket.IO",
    "PostgreSQL",
    "Vite",
    "JWT",
    "WebRTC",
    "Zod",
    "Node.js"
  ],
  "features": [
    {
      "name": "Health Check",
      "description": "Server health check endpoint",
      "files": ["apps/server/src/index.ts"],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/healthz": {
            "get": {
              "summary": "Health check endpoint",
              "responses": {
                "200": {
                  "description": "Server is healthy",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "status": {
                            "type": "string",
                            "example": "ok"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Authentication",
      "description": "JWT-based authentication with login and token refresh",
      "files": ["apps/server/src/index.ts"],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/auth/login": {
            "post": {
              "summary": "Staff login",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "password": {
                          "type": "string"
                        }
                      },
                      "required": ["email", "password"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Login successful",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "token": {
                            "type": "string"
                          },
                          "refreshToken": {
                            "type": "string"
                          },
                          "user": {
                            "type": "object"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "/api/auth/refresh-token": {
            "post": {
              "summary": "Refresh access token",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "refreshToken": {
                          "type": "string"
                        }
                      },
                      "required": ["refreshToken"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Token refreshed"
                }
              }
            }
          },
          "/api/auth/logout": {
            "post": {
              "summary": "Logout user",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "Logout successful"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Call Management API",
      "description": "Production-grade call lifecycle management with CAS operations",
      "files": ["apps/server/src/routes/calls.ts", "apps/server/src/repositories/CallRepository.ts"],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/v1/calls": {
            "post": {
              "summary": "Initiate a video call",
              "security": [{"bearerAuth": []}],
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "orgId": {
                          "type": "string"
                        },
                        "clientId": {
                          "type": "string"
                        },
                        "reason": {
                          "type": "string"
                        },
                        "targetStaffId": {
                          "type": "string"
                        },
                        "department": {
                          "type": "string"
                        }
                      },
                      "required": ["clientId"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Call initiated",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "callId": {
                            "type": "string"
                          },
                          "status": {
                            "type": "string",
                            "enum": ["ringing", "initiated"]
                          }
                        }
                      }
                    }
                  }
                },
                "503": {
                  "description": "No available staff"
                }
              }
            }
          },
          "/api/v1/calls/{callId}/accept": {
            "post": {
              "summary": "Accept a call (CAS-protected)",
              "security": [{"bearerAuth": []}],
              "parameters": [
                {
                  "name": "callId",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Call accepted"
                },
                "409": {
                  "description": "Call already accepted or not in ringing state"
                }
              }
            }
          },
          "/api/v1/calls/{callId}/decline": {
            "post": {
              "summary": "Decline a call",
              "security": [{"bearerAuth": []}],
              "parameters": [
                {
                  "name": "callId",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "reason": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Call declined"
                }
              }
            }
          },
          "/api/v1/calls/{callId}/cancel": {
            "post": {
              "summary": "Cancel a call",
              "security": [{"bearerAuth": []}],
              "parameters": [
                {
                  "name": "callId",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Call canceled"
                }
              }
            }
          },
          "/api/v1/calls/{callId}/end": {
            "post": {
              "summary": "End a call",
              "security": [{"bearerAuth": []}],
              "parameters": [
                {
                  "name": "callId",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Call ended"
                }
              }
            }
          },
          "/api/v1/calls/{callId}": {
            "get": {
              "summary": "Get call details",
              "security": [{"bearerAuth": []}],
              "parameters": [
                {
                  "name": "callId",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Call details with participants"
                },
                "404": {
                  "description": "Call not found"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Staff Availability API",
      "description": "Manage staff availability status and query available staff",
      "files": ["apps/server/src/routes/staff.ts", "apps/server/src/repositories/StaffAvailabilityRepository.ts"],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/v1/staff/availability": {
            "get": {
              "summary": "Get available staff",
              "security": [{"bearerAuth": []}],
              "parameters": [
                {
                  "name": "orgId",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "skills",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "List of available staff",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "staff": {
                            "type": "array",
                            "items": {
                              "type": "object"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "post": {
              "summary": "Set staff availability status",
              "security": [{"bearerAuth": []}],
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "string",
                          "enum": ["available", "busy", "away", "offline"]
                        },
                        "orgId": {
                          "type": "string"
                        },
                        "skills": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      },
                      "required": ["status"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Availability updated"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Legacy Call API",
      "description": "Legacy call initiation and WebRTC signaling endpoints",
      "files": ["apps/server/src/index.ts"],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/calls/initiate": {
            "post": {
              "summary": "Initiate call (legacy)",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "Call initiated"
                }
              }
            }
          },
          "/api/calls/accept": {
            "post": {
              "summary": "Accept call (legacy)",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "Call accepted"
                }
              }
            }
          },
          "/api/calls/decline": {
            "post": {
              "summary": "Decline call (legacy)",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "Call declined"
                }
              }
            }
          },
          "/api/calls/sdp": {
            "post": {
              "summary": "Exchange SDP offer/answer",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "SDP exchanged"
                }
              }
            }
          },
          "/api/calls/ice": {
            "post": {
              "summary": "Exchange ICE candidates",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "ICE candidate exchanged"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Notifications API",
      "description": "Real-time notification management",
      "files": ["apps/server/src/index.ts"],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/notifications": {
            "get": {
              "summary": "Get all notifications",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "List of notifications"
                }
              }
            },
            "post": {
              "summary": "Create notification",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "Notification created"
                }
              }
            }
          },
          "/api/notifications/unread": {
            "get": {
              "summary": "Get unread notifications",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "List of unread notifications"
                }
              }
            }
          },
          "/api/notifications/{id}/read": {
            "patch": {
              "summary": "Mark notification as read",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "Notification marked as read"
                }
              }
            }
          },
          "/api/notifications/read-all": {
            "patch": {
              "summary": "Mark all notifications as read",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "All notifications marked as read"
                }
              }
            }
          },
          "/api/notifications/{id}": {
            "delete": {
              "summary": "Delete notification",
              "security": [{"bearerAuth": []}],
              "responses": {
                "200": {
                  "description": "Notification deleted"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "User API",
      "description": "User profile and information",
      "files": ["apps/server/src/index.ts"],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/user/{username}": {
            "get": {
              "summary": "Get user information",
              "security": [{"bearerAuth": []}],
              "parameters": [
                {
                  "name": "username",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "User information"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Socket.IO Real-time Communication",
      "description": "Real-time signaling for WebRTC calls and notifications",
      "files": ["apps/server/src/socket.ts"],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Socket.IO Events",
          "version": "1.0.0"
        },
        "paths": {},
        "components": {
          "schemas": {
            "SocketEvents": {
              "type": "object",
              "properties": {
                "call.initiated": {
                  "description": "Emitted when a call is initiated",
                  "type": "object"
                },
                "call.accepted": {
                  "description": "Emitted when a call is accepted",
                  "type": "object"
                },
                "call.declined": {
                  "description": "Emitted when a call is declined",
                  "type": "object"
                },
                "call.canceled": {
                  "description": "Emitted when a call is canceled",
                  "type": "object"
                },
                "call.ended": {
                  "description": "Emitted when a call ends",
                  "type": "object"
                },
                "call:update": {
                  "description": "Emitted when call state updates",
                  "type": "object"
                },
                "call:incoming": {
                  "description": "Legacy event for incoming calls",
                  "type": "object"
                },
                "call:sdp": {
                  "description": "WebRTC SDP exchange",
                  "type": "object"
                },
                "call:ice": {
                  "description": "WebRTC ICE candidate exchange",
                  "type": "object"
                }
              }
            }
          }
        }
      }
    }
  ]
}
